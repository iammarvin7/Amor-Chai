(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{4121:(e,s,a)=>{Promise.resolve().then(a.bind(a,5352))},5352:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>o});var t=a(7437),r=a(2265),l=a(3537),i=a(1314),n=a(4248);let c=()=>(0,t.jsxs)("div",{className:"relative w-full h-full animate-pulse space-y-8 flex flex-col justify-center",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"h-6 w-1/3 bg-white/50 rounded"})," ",(0,t.jsx)("div",{className:"h-12 w-full bg-white/30 rounded"})," ",(0,t.jsx)("div",{className:"h-12 w-full bg-white/30 rounded"})," ",(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsx)("div",{className:"h-12 w-full bg-white/30 rounded"})," ",(0,t.jsx)("div",{className:"h-12 w-full bg-white/30 rounded"})," "]})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"h-6 w-1/4 bg-white/50 rounded"})," ",(0,t.jsx)("div",{className:"h-48 w-full bg-white/30 rounded border border-white/20"})," "]}),(0,t.jsx)("div",{className:"h-12 w-full bg-amber-200/50 rounded"})]}),d=(0,l.J)("pk_test_51SSiXvPmpeAv1NHftttjts5B0xb1HpsVB2GAU0jfY3kp5MfTwUH1IfMwfKFHHOeBkO85pUN4Srorki6If7iLQNjQ002naLvmmL");function o(){let[e,s]=(0,r.useState)(null),[a,l]=(0,r.useState)([]),[o,x]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=[];try{let s=localStorage.getItem("amor_cart");s&&(e=JSON.parse(s),l(e))}catch(e){console.error("Local cart error:",e)}(async()=>{let{data:{user:s}}=await n.Z.auth.getUser();if(s){let{data:a,error:t}=await n.Z.from("user_cart").select("*").eq("user_id",s.id).order("created_at",{ascending:!0});if(!t&&a){let s=a.map(e=>({id:e.product_id,name:e.product_name,price:parseFloat(e.product_price),image:e.product_image,qty:e.quantity}));if(s.length>e.length||JSON.stringify(s)!==JSON.stringify(e))return console.log("Syncing cart from Supabase..."),l(s),localStorage.setItem("amor_cart",JSON.stringify(s)),s}}return e})().then(e=>{if(0===e.length){x("Your cart is empty.");return}fetch("/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:e})}).then(e=>e.json()).then(e=>{e.clientSecret?s(e.clientSecret):x(e.error||"Failed to initialize payment.")}).catch(()=>x("An unexpected error occurred."))})},[]);let h=a.reduce((e,s)=>e+s.price*s.qty,0),u=.08*h,p=h+u,f=e?{clientSecret:e,appearance:{theme:"stripe"}}:void 0;return(0,t.jsxs)("div",{className:"min-h-screen w-full flex flex-col lg:flex-row items-start",children:[(0,t.jsx)("div",{className:"w-full lg:w-[45%] bg-gray-50 border-r border-gray-200 lg:min-h-screen flex flex-col px-8 py-12 lg:sticky lg:top-0",children:(0,t.jsxs)("div",{className:"max-w-md mx-auto w-full",children:[(0,t.jsx)("img",{src:"/assets/logo.png",alt:"Amor Chai Logo",className:"h-12 mb-8"}),(0,t.jsx)("h1",{className:"text-xl font-semibold mb-6",children:"Order Summary"}),a.length>0?(0,t.jsxs)("div",{className:"space-y-4",children:[a.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("img",{src:e.image,alt:e.name,className:"w-16 h-16 rounded-md object-cover"}),(0,t.jsxs)("div",{className:"flex-grow",children:[(0,t.jsx)("p",{className:"font-semibold",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-600",children:["Quantity: ",e.qty]})]}),(0,t.jsxs)("p",{className:"font-semibold",children:["$",(e.price*e.qty).toFixed(2)]})]},e.id)),(0,t.jsxs)("div",{className:"border-t pt-4 mt-4 space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Subtotal"}),(0,t.jsxs)("span",{children:["$",h.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Tax (8%)"}),(0,t.jsxs)("span",{children:["$",u.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between font-bold text-base border-t pt-2 mt-2",children:[(0,t.jsx)("span",{children:"Total"}),(0,t.jsxs)("span",{children:["$",p.toFixed(2)]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap justify-center gap-2 mt-4",children:[(0,t.jsx)("img",{src:"/assets/icons/Visa.png",alt:"Visa",className:"h-8 w-auto object-contain"}),(0,t.jsx)("img",{src:"/assets/icons/Mastercard.png",alt:"Mastercard",className:"h-8 w-auto object-contain"}),(0,t.jsx)("img",{src:"/assets/icons/Amex.png",alt:"American Express",className:"h-8 w-auto object-contain"}),(0,t.jsx)("img",{src:"/assets/icons/ApplePay.png",alt:"Apple Pay",className:"h-8 w-auto object-contain"}),(0,t.jsx)("img",{src:"/assets/icons/GooglePay.png",alt:"Google Pay",className:"h-8 w-auto object-contain"})]}),(0,t.jsx)("div",{className:"border-t border-gray-200 mt-6 pt-6",children:(0,t.jsxs)("div",{className:"flex flex-wrap justify-center gap-4 text-xs text-gray-500 font-medium",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{children:"\uD83D\uDD12"})," Secure SSL Encryption"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{children:"\uD83D\uDEE1ï¸"})," Buyer Protection"]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)("span",{children:"\uD83D\uDE9A"})," Local Delivery (Cape Girardeau)"]})]})})]}):(0,t.jsx)("p",{className:"text-gray-500",children:o?"Your cart is empty.":"Loading cart..."})]})}),(0,t.jsx)("div",{className:"w-full lg:w-[55%] min-h-screen flex flex-col px-8 py-12 lg:overflow-y-auto transition-colors duration-700 ".concat(e?"bg-white":"bg-gradient-to-br from-matcha-lightest to-matcha-darkest"),children:(0,t.jsxs)("div",{className:"w-full max-w-md mx-auto h-full",children:[o&&(0,t.jsx)("p",{className:"text-red-500 text-center mb-4",children:o}),e&&f?(0,t.jsx)(i.eK,{options:f,stripe:d,children:(0,t.jsx)(m,{})}):!o&&(0,t.jsx)("div",{className:"h-full flex flex-col justify-center",children:(0,t.jsx)(c,{})})]})})]})}function m(){let e=(0,i.MD)(),s=(0,i.lq)(),[a,l]=(0,r.useState)(null),[n,c]=(0,r.useState)(!1),[d,o]=(0,r.useState)(!1),[m,x]=(0,r.useState)(!1),[h,u]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1),g=async a=>{if(a.preventDefault(),!e||!s||m||d)return;c(!0),o(!0);try{let e=await fetch("/api/verify-delivery-zone",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({address:h})});if(!(await e.json()).allowed){x(!0),c(!1),o(!1);return}}catch(e){x(!0),c(!1),o(!1);return}o(!1);let{error:t}=await e.confirmPayment({elements:s,confirmParams:{return_url:"".concat(window.location.origin,"/return")}});"card_error"===t.type||"validation_error"===t.type?l(t.message||"An unexpected error occurred."):l("An unexpected error occurred."),c(!1)};return(0,t.jsxs)("form",{id:"payment-form",onSubmit:g,className:"space-y-6 relative",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-base font-semibold mb-2",children:"Shipping Address"}),(0,t.jsx)(i.H3,{options:{mode:"shipping"},onChange:e=>{e.complete&&(u(e.value.address),m&&x(!1))}})]}),(0,t.jsx)("div",{className:"relative min-h-[300px]",children:m?(0,t.jsxs)("div",{className:"space-y-4 animate-fade-in mt-6",children:[(0,t.jsx)("div",{className:"text-red-600 text-sm font-semibold text-center",children:"We currently only deliver within 10 miles of Cape Girardeau via the website."}),(0,t.jsxs)("div",{className:"w-full max-w-lg bg-white border border-gray-200 rounded-xl p-8 shadow-sm flex flex-col items-center text-center space-y-3",children:[(0,t.jsx)("p",{className:"text-sm text-gray-800",children:"Still want to feel the flavors loved by many? We might still be able to make it happen! Contact us on Instagram to arrange a special delivery."}),(0,t.jsxs)("a",{href:"https://www.instagram.com/drinkamorchai/",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-full shadow-sm hover:bg-gray-50 transition-colors text-sm font-medium text-gray-700",children:[(0,t.jsx)("img",{src:"/assets/instagram.png",alt:"Instagram",className:"w-5 h-5"}),(0,t.jsx)("span",{children:"Contact us"})]})]})]}):(0,t.jsxs)(t.Fragment,{children:[(!p||!e||!s)&&(0,t.jsx)("div",{className:"absolute inset-0 z-10 bg-white pt-2",children:(0,t.jsxs)("div",{className:"w-full animate-pulse space-y-8",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("div",{className:"h-6 w-1/4 bg-gray-200 rounded"}),(0,t.jsx)("div",{className:"h-48 w-full bg-gray-100 rounded border border-gray-200"})]}),(0,t.jsx)("div",{className:"h-12 w-full bg-amber-200 rounded opacity-50"})]})}),(0,t.jsxs)("div",{className:p?"opacity-100 animate-in fade-in duration-500":"opacity-0 pointer-events-none h-0 overflow-hidden",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-base font-semibold mb-2",children:"Payment"}),(0,t.jsx)(i.Hn,{id:"payment-element",onReady:()=>f(!0)})]}),(0,t.jsxs)("div",{className:"relative mt-6",children:[d&&(0,t.jsx)("div",{className:"absolute inset-0 bg-white/60 backdrop-blur-[1px] z-10 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-full h-full animate-pulse bg-gray-100/50 rounded-md"})}),(0,t.jsx)("button",{disabled:n||!e||!s||d,id:"submit",className:"w-full bg-blue-600 text-white font-bold py-3 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:(0,t.jsx)("span",{id:"button-text",children:n?(0,t.jsx)("div",{className:"spinner"}):"Pay now"})})]}),a&&(0,t.jsx)("div",{id:"payment-message",className:"text-red-500 mt-2 text-center text-sm",children:a})]})]})})]})}},4248:(e,s,a)=>{"use strict";a.d(s,{Z:()=>n});var t=a(46);let r="https://pgabcwsdvmwwqmdkqvhx.supabase.co",l="sb_publishable_lmVyROZ1EG6_ARWDAbks7w_Ff7DXfPn",i=null;r&&l&&(i=(0,t.eI)(r,l));let n=i}},e=>{var s=s=>e(e.s=s);e.O(0,[46,275,130,215,744],()=>s(4121)),_N_E=e.O()}]);