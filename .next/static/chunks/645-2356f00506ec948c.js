"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[645],{8456:(e,r,t)=>{t.d(r,{H:()=>s,a:()=>n});var a=t(7437),o=t(2265),i=t(4248);let l=(0,o.createContext)(null),n=()=>(0,o.useContext)(l)||{user:null,session:null,isLoading:!0,signingOut:!1,signOutSuccessMessage:null,showReloadAlert:!1,handleSignOut:async()=>{},clearSignOutMessage:()=>{},dismissReloadAlert:()=>{}},s=e=>{let{children:r}=e,[t,n]=(0,o.useState)(null),[s,u]=(0,o.useState)(null),[c,d]=(0,o.useState)(!0),[g,m]=(0,o.useState)(!1),[p,f]=(0,o.useState)(null),[h,S]=(0,o.useState)(!1),[y,v]=(0,o.useState)(!1),[b,_]=(0,o.useState)("login"),k=(0,o.useRef)(null),w=(0,o.useRef)(!1),C=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"login";_(e),v(!0)},E=()=>{v(!1)},Z=(0,o.useCallback)(()=>{try{localStorage.removeItem("amor-cart");let e=[];for(let r=0;r<localStorage.length;r++){let t=localStorage.key(r);t&&(t.startsWith("sb-")||t.includes("supabase")||t.includes("auth-token"))&&e.push(t)}e.forEach(e=>localStorage.removeItem(e));let r=[];for(let e=0;e<sessionStorage.length;e++){let t=sessionStorage.key(e);t&&(t.startsWith("sb-")||t.includes("supabase")||t.includes("auth-token"))&&r.push(t)}r.forEach(e=>sessionStorage.removeItem(e))}catch(e){console.error("Error clearing storage:",e)}},[]),O=(0,o.useCallback)(()=>{if(k.current){try{k.current.unsubscribe()}catch(e){console.error("Error unsubscribing from auth listener:",e)}k.current=null}},[]),q=(0,o.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(w.current){console.warn("Sign-out already in progress, ignoring duplicate call");return}if(!i.Z){console.error("Supabase client not available"),e&&e("Sign-out failed: Supabase not configured");return}w.current=!0,m(!0);let r=!1,t=!1;try{O();let e=null;try{let r=i.Z.auth.signOut(),t=new Promise((e,r)=>setTimeout(()=>r(Error("Sign-out timeout after 10 seconds")),1e4)),a=await Promise.race([r,t]);a&&"object"==typeof a&&"error"in a?e=a.error:a instanceof Error&&(e=a)}catch(r){console.error("Sign-out failed or timed out:",r),e=r}if(!e){var a,o;let e=await i.Z.auth.getSession();if(null===(a=e.data)||void 0===a?void 0:a.session){console.warn("Session still exists after signOut, retrying...");try{let r=i.Z.auth.signOut(),t=new Promise((e,r)=>setTimeout(()=>r(Error("Retry sign-out timeout")),5e3)),a=await Promise.race([r,t]);(null==a?void 0:a.error)&&console.error("Retry signOut error:",a.error),await new Promise(e=>setTimeout(e,200)),e=await i.Z.auth.getSession(),(null===(o=e.data)||void 0===o?void 0:o.session)&&console.error("Session still exists after retry - proceeding with cleanup anyway")}catch(e){console.error("Retry sign-out failed:",e)}}}Z(),n(null),u(null),f("Signed out successfully. Please reload the page."),S(!0),r=!0,t=!1}catch(r){console.error("Error during sign-out:",r);try{console.log("Performing manual cleanup after sign-out error"),O(),Z(),n(null),u(null),t=!0}catch(e){console.error("Error in fallback cleanup:",e),t=!0}e&&e("Sign-out completed with errors, but you have been logged out locally.")}finally{m(!1),w.current=!1,t&&!r&&setTimeout(()=>{window.location.replace("/")},100)}},[Z,O]);(0,o.useEffect)(()=>{if(!i.Z){d(!1);return}let e=!0;(async()=>{try{let{data:{session:t},error:a}=await i.Z.auth.getSession();if(!e)return;if(a)console.error("Error getting session:",a),n(null),u(null);else{var r;u(t),n(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null)}}catch(r){console.error("Error initializing auth:",r),e&&(n(null),u(null))}finally{e&&d(!1)}})();let{data:{subscription:r}}=i.Z.auth.onAuthStateChange(async(r,t)=>{var a;(!w.current||"SIGNED_OUT"!==r)&&e&&(u(t),n(null!==(a=null==t?void 0:t.user)&&void 0!==a?a:null),"SIGNED_OUT"===r&&(n(null),u(null)))});return k.current=r,()=>{if(e=!1,r)try{r.unsubscribe()}catch(e){console.error("Error unsubscribing on cleanup:",e)}}},[]);let A=(0,o.useMemo)(()=>({user:t,session:s,isLoading:c,signingOut:g,signOutSuccessMessage:p,showReloadAlert:h,isAuthModalOpen:y,authModalTab:b,openAuthModal:C,closeAuthModal:E,handleSignOut:q,clearSignOutMessage:()=>f(null),dismissReloadAlert:()=>S(!1)}),[t,s,c,g,p,h,y,b,q]);return(0,a.jsx)(l.Provider,{value:A,children:r})}},5587:(e,r,t)=>{t.d(r,{Z:()=>u,j:()=>s});var a=t(7437),o=t(2265),i=t(4248),l=t(8456);let n=(0,o.createContext)(null),s=()=>(0,o.useContext)(n),u=e=>{let{children:r}=e,[t,s]=(0,o.useState)(()=>{try{let e=localStorage.getItem("amor_cart");return e?JSON.parse(e):[]}catch(e){console.error("Error initializing cart from local storage",e)}return[]}),[u,c]=(0,o.useState)(!1),[d,g]=(0,o.useState)(!0),[m,p]=(0,o.useState)(null),[f,h]=(0,o.useState)(!1),S=(0,o.useRef)(!1),y=(0,o.useRef)(null),v=(0,o.useRef)(!1),b=(0,l.a)(),_=(null==b?void 0:b.signingOut)||!1;(0,o.useEffect)(()=>{v.current=_},[_]);let k=e=>({product_id:String(e.id),product_name:e.name||"",product_price:e.price||0,product_image:e.image||"",quantity:e.qty||1}),w=e=>({id:e.product_id,name:e.product_name,price:parseFloat(e.product_price),image:e.product_image,qty:e.quantity}),C=async e=>{if(!i.Z||!e)return[];h(!0);try{let{data:r,error:t}=await i.Z.from("user_cart").select("*").eq("user_id",e).order("created_at",{ascending:!0});if(t)return console.error("Error loading cart from Supabase:",t),[];let a=(r||[]).map(w);return O(a),a}catch(e){return console.error("Error loading cart:",e),[]}finally{h(!1)}},E=async(e,r)=>{if(i.Z&&e&&!S.current){S.current=!0;try{if(0===r.length)await i.Z.from("user_cart").delete().eq("user_id",e);else{let t=r.map(r=>({user_id:e,...k(r)})),{error:a}=await i.Z.from("user_cart").upsert(t,{onConflict:"user_id, product_id"});a&&"42P01"!==a.code&&console.error("Error syncing cart to Supabase:",a);let o=r.map(e=>String(e.id));o.length>0&&await i.Z.from("user_cart").delete().eq("user_id",e).not("product_id","in","(".concat(o.join(","),")"))}}catch(e){(null==e?void 0:e.code)!=="42P01"&&(null==e?void 0:e.message)!=='relation "public.user_cart" does not exist'&&console.error("Error saving cart:",e)}finally{S.current=!1}}},Z=()=>{try{let e=localStorage.getItem("amor_cart");if(e)return JSON.parse(e)}catch(e){console.error("Error loading cart from localStorage:",e)}return[]},O=e=>{try{localStorage.setItem("amor_cart",JSON.stringify(e))}catch(e){console.error("Error saving cart to localStorage:",e)}};(0,o.useEffect)(()=>{if(!i.Z){s(Z()),g(!1);return}(async()=>{let{data:{user:e}}=await i.Z.auth.getUser(),r=(null==e?void 0:e.id)||null;p(r),r?s(await C(r)):s(Z()),g(!1)})();let{data:{subscription:e}}=i.Z.auth.onAuthStateChange(async(e,r)=>{var t;let a=(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.id)||null;a?(p(a),s(await C(a))):(p(null),s([]),v.current||s(Z()))});return y.current=e,()=>{if(e)try{e.unsubscribe()}catch(e){console.error("Error unsubscribing from cart auth listener:",e)}}},[]),(0,o.useEffect)(()=>{d||f||_||(O(t),m&&i.Z&&E(m,t))},[t,m,d,f,_]);let q=e=>{s(r=>{let t;return O(t=r.find(r=>r.id===e.id)?r.map(r=>r.id===e.id?{...r,qty:r.qty+1}:r):[...r,{...e,qty:1}]),t}),c(!0)},A=e=>{s(r=>{let t;let a=r.find(r=>r.id===e);return a?(O(t=a.qty>1?r.map(r=>r.id===e?{...r,qty:r.qty-1}:r):r.filter(r=>r.id!==e)),t):r})},N=(e,r)=>{s(t=>{let a=t.map(t=>t.id===e?{...t,qty:Math.max(1,r)}:t);return O(a),a})},P=()=>{if(_){console.log("Sign-out in progress: skipping cart clear to preserve DB cart");return}s([]),m&&i.Z&&i.Z.from("user_cart").delete().eq("user_id",m).catch(console.error);try{localStorage.removeItem("amor_cart")}catch(e){console.error("Error clearing localStorage:",e)}},x=()=>c(e=>!e),R=()=>c(!0),z=()=>c(!1),F=(0,o.useMemo)(()=>t.reduce((e,r)=>e+(r.price||0)*(r.qty||1),0),[t]),I=(0,o.useMemo)(()=>({items:t,addItem:q,removeItem:A,updateQty:N,clear:P,total:F,isOpen:u,toggle:x,open:R,close:z,isLoading:d}),[t,F,u,d]);return(0,a.jsx)(n.Provider,{value:I,children:r})}},6210:(e,r,t)=>{t.d(r,{b:()=>c,o:()=>u});var a=t(7437),o=t(2265),i=t(4248),l=t(8456),n=t(1575);let s=(0,o.createContext)(null),u=()=>(0,o.useContext)(s)||{likeCounts:{},userLikes:new Set,isLoading:!0,refreshLikes:async()=>{}},c=e=>{let{children:r}=e,[t,u]=(0,o.useState)(()=>{try{let e=localStorage.getItem("amor_like_counts");return e?JSON.parse(e):{}}catch(e){}return{}}),[c,d]=(0,o.useState)(()=>{try{let e=localStorage.getItem("amor_user_likes");return e?new Set(JSON.parse(e)):new Set}catch(e){}return new Set}),[g,m]=(0,o.useState)(!0),{user:p}=(0,l.a)(),f=(0,o.useCallback)(async()=>{if(!i.Z)return m(!1),{};try{let e=n.map(e=>String(e.id)),r={};e.forEach(e=>{r[e]=0});let{data:t,error:a}=await i.Z.from("product_likes").select("product_id");if(a)return"PGRST116"!==a.code&&"permission denied for table product_likes"!==a.message&&console.error("Error fetching all like counts:",a),r;return t&&t.length>0&&t.forEach(e=>{let t=String(e.product_id);void 0!==r[t]&&(r[t]=(r[t]||0)+1)}),r}catch(t){console.error("Unexpected error fetching all like counts:",t);let e=n.map(e=>String(e.id)),r={};return e.forEach(e=>{r[e]=0}),r}},[]),h=(0,o.useCallback)(async e=>{if(!i.Z||!e)return new Set;try{let r=n.map(e=>String(e.id)),{data:t,error:a}=await i.Z.from("product_likes").select("product_id").eq("user_id",e).in("product_id",r);if(a)return console.error("Error fetching user likes:",a),new Set;let o=new Set;return t&&t.forEach(e=>{o.add(String(e.product_id))}),o}catch(e){return console.error("Unexpected error fetching user likes:",e),new Set}},[]),S=(0,o.useCallback)(async()=>{if(!i.Z)return;let[e,r]=await Promise.all([f(),p?h(p.id):Promise.resolve(new Set)]);u(e),d(r),localStorage.setItem("amor_like_counts",JSON.stringify(e)),localStorage.setItem("amor_user_likes",JSON.stringify(Array.from(r))),m(!1)},[f,h,p]);(0,o.useEffect)(()=>{S()},[S]),(0,o.useEffect)(()=>{if(!i.Z)return;let{data:{subscription:e}}=i.Z.auth.onAuthStateChange(async(e,r)=>{var t;let a=(null==r?void 0:null===(t=r.user)||void 0===t?void 0:t.id)||null;a?d(await h(a)):d(new Set)});return()=>{e&&e.unsubscribe()}},[h]);let y=(0,o.useMemo)(()=>({likeCounts:t,userLikes:c,isLoading:g,refreshLikes:S}),[t,c,g,S]);return(0,a.jsx)(s.Provider,{value:y,children:r})}},4248:(e,r,t)=>{t.d(r,{Z:()=>n});var a=t(46);let o="https://pgabcwsdvmwwqmdkqvhx.supabase.co",i="sb_publishable_lmVyROZ1EG6_ARWDAbks7w_Ff7DXfPn",l=null;o&&i&&(l=(0,a.eI)(o,i));let n=l},1575:e=>{e.exports=JSON.parse('[{"id":1,"name":"Signature Chai","price":4.25,"description":"Assam black tea, milk, sugar, green cardamom","image":"/assets/SigChai.png"},{"id":2,"name":"Flavored Chai","flavors":["Salted Caramel","Lavender","Vanilla","Pumpkin Spice"],"description":"Assam black tea, milk, sugar, green cardamom, + your favourite Flavour","price":4.75,"image":"/assets/flav.png"},{"id":3,"name":"Dirty Chai Latte","description":"Assam black tea, milk, sugar, green cardamom,cold brew, + your favourite Flavour","price":5.25,"image":"/assets/dirtyChai.png"},{"id":4,"name":"Jaipur Chai","description":"Assam black tea, milk, sugar, green cardamom, your favourite Flavour, Cold Foam","price":6.25,"image":"/assets/pinkFlav.png"},{"id":5,"name":"Midnight Chai","description":"Assam black tea, milk, sugar, green cardamom, your favourite Flavour, Cold Foam","price":6.25,"image":"/assets/purpleFlav.png"},{"id":6,"name":"Nutella Chai","description":"Assam black tea, milk, sugar, green cardamom, your favourite Flavour, Nutella, Cold Foam","price":6.25,"image":"/assets/NutellaFlav.png"},{"id":7,"name":"Dubai Chocolate Cups","size":"9oz","price":8.99,"description":"Kadayi, Pistachio cream, Strawberries, Brownie, Nutella","image":"/assets/DubaiChocolate.png"},{"id":8,"name":"Strawberries + Nutella","description":"Strawberries and Nutella","size":"9oz","price":6.99,"image":"/assets/StrawberryNutella.png"},{"id":9,"name":"Signature Chai Masala","size":"1oz","price":3.99,"description":"Assam black tea, cinnamon, green cardamom, cloves","image":"/assets/sigLTB.jpg"},{"id":10,"name":"Gujarati-Style Mint Chai","size":"1oz","price":3.99,"description":"Assam black tea, mint","image":"/assets/mintLTB.jpg"},{"id":11,"name":"Luna Lavender Chai","size":"1oz","price":3.99,"description":"Assam black tea, lavender, cardamom, clove","image":"/assets/lavenderLTB.jpg"},{"id":12,"name":"Chocolate Rose Chai","size":"1oz","price":3.99,"description":"Assam black tea, cinnamon, cardamom, clove, organic cacao nibs, organic rose petals","image":"/assets/roseLTB.jpg"}]')}}]);